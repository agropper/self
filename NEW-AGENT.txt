# Provisioning Information

---

## MAIA INSTRUCTION TEXT

You are MAIA, a medical AI assistant, that can search through a patient's health records in a knowledge base and provide relevant answers to their requests. Use only information in the attached knowledge bases and never fabricate information. There is a lot of redundancy in a patient's knowledge base. When information appears multiple times you can safely ignore the repetitions. 

**Current Medications Priority**: When generating a patient summary, if a Current Medications list is provided in the request, use it as the authoritative source for the Current Medications section. The patient has reviewed and confirmed this list, so it takes precedence over any medication information found in the knowledge base. Only extract medications from the knowledge base if no Current Medications list is provided in the request.

To ensure that all medications are accurately listed when extracting from the knowledge base (when no Current Medications list is provided), the assistant should adopt a systematic approach: Comprehensive Review: Thoroughly examine every chunk in the knowledge base to identify all medication entries, regardless of their status (active or stopped). Avoid Premature Filtering: Refrain from filtering medications based on their status unless explicitly instructed to do so. This ensures that all prescribed medications are included. Consolidation of Information: Use a method to consolidate medication information from all chunks, ensuring that each medication is listed only once, even if it appears multiple times across different chunks. Cross-Referencing: Cross-reference information from multiple chunks to verify the completeness and accuracy of the medication list. Systematic Extraction: Implement a systematic process or algorithm to extract medication information, reducing the likelihood of human error or oversight. 

If you are asked for a patient summary, use the following categories and format: Highlight the label and category headings. Display the patient's name followed by their age and sex. A concise medical history; including surgical history -- Doctors seen recently (say, within a year) and diagnoses of those visits -- Current Medications -- Stopped or Inactive Medications --Allergies --Brief social history: employment (or school) status; living situation; use of tobacco, alcohol, drugs --Radiology in the past year --Other testing in the past year (PFTs, EKGs, etc)

**Agent's Perspective**
Write from the perspective of a physician creating a summary for an on-call physician who has never seen the patient.

**Errors and Redactions** 
Remove any mention of problems or medications for sexual function.

**Format and Language**
Always start your response with the patient's name, age and sex. Do not show your reasoning. Provide the response in English. Format section headings so they are not too large.

---

## Private AI Setup Wizard

The Wizard steps through the essentials to set up your MAIA.

Step 1 is automatic but takes about three minutes. 

Step 2 uses an Apple Health export file to create a Current Medications list and an index to help navigate your helth records. Skip Step 2 if you don't have this file. 

Step 3 adds other health records files and then indexes them into a private knowledge base accessible only via your private AI agent. Indexing can take up to 60 minutes. 

In Step 4, the Private AI uses your records to create a Patient Summary. Once you correct and verify the summary the Wizard is done.



[ ] 1 - Creating your Private AI agent
        Pending <elapsed time> or Ready to chat

[ ] 2 - Add your Apple Health "Export PDF" file           [ADD FILE] or [VERIFY] or [RESTORE]
        <filename> and Current Medications verified or Skipped

[ ] 3 - Add any health records you want included          [ADD FILE] or [INDEX]
        <filename> and [RESTORE]
        <filename> and [RESTORE]
        ...
        Indexing or Complete <elapsed time>, # files, # bytes, # tokens

[ ] 4 - Review and verify your Patient Summary            [VERIFY]


                                                          [NOT YET]

---

## Workflow Stages and tips

The following workflow stages are used to track user progress through the provisioning and setup process:

1. **null** - Initial state when user account is created
2. **request_sent** - User registration complete, admin has been notified and can provision
3. **approved** - Admin has started provisioning the user
4. **agent_named** - Agent has been successfully created in DigitalOcean
5. **agent_deployed** - Agent deployment has reached STATUS_RUNNING and is ready to use
6. **files_stored** - User has uploaded files to their account
7. **unknown** - Fallback/default value when workflowStage is not set
8. **files_archived** - User has imported at least one file
9. **indexing** - KB creation and indexing in progress
10. **patient_summary** - A patient summary has been saved in My Stuff
11. **public_llm** - The AI dropdown is not set to "Private AI"
12. **chat_modified** - The chat save locally and to group buttons are shown
13. **link_stored** - The chat has been added to a group



Tips for each stage can be added below:

2. Support requested. You will be notified when your private AI agent is ready.
5. Your agent is ready. Use the paperclip to import files for your knowledge base.
8. Update your knowledge base using the [Stored Files](Stored Files tab link) tab.
9. Knowledge base being indexed. This can take up to 60 minutes.
10. Your patient summary is available. Ask your agent for it in the chat anytime.
11. Public AIs see only what you see in the chat, including any paperclip documents.
12. You can save the chat to your computer or save it online.
13. Open [Saved Chats](Saved Chats tab link) to restore one or share a deep link.

---

## PRIVATE AI SETUP WIZARD MESSAGES

1. Creating your Private AI agent. This can take several minutes.
  
2. Add your Apple Health "Export PDF" file to get started. If you don't have an Apple Health file, click NOT YET. You will be able to add a file or manage your current medications manually on the My Lists tab.
   - Stage 2 is never disabled. A user can add the PDF even after they have other files.
   - OK displays the file chooser, saves the file as imported, and then launches the My Lists tab.
    - Not yet dismisses the wizard until the next page reload.
  - Stage 2 is checked off when the My Lists modal is closed or there's a Current Medications list.

3. Add any health records you want included. You can add files now or later from the My Stuff Files tab.
   - Add Files opens the file chooser and then the Files tab.
   - Restore Files opens the Files tab for rehydration when applicable.

4. Review and verify your Patient Summary. Use the Patient Summary tab any time to update or edit it.
   - If Stage 5 is complete, then there is a Patient Summary and the SETUP WIZARD is not displayed.
   - OK is enabled if there are files in the knowledge base. It displays the Patient Summary tab.
   - Not yet just closes the modal.

---

## PRIVATE AI SETUP WIZARD DESIGN NOTES

The Setup Wizard is a UI guide driven by user state and a small amount of per-session persistence. Stage 1 completes when the agent is deployed and has a live endpoint. Stage 2 completes only when a Current Medications list exists in the user document; uploading the Apple Health PDF starts list extraction but does not complete Stage 2 by itself. Stage 3 is intentionally conservative: it only completes when the user explicitly clicks "Not yet" (and KB has indexed files), or when we later decide to mark it from objective signals. Stage 4 completes once a Patient Summary exists; when Stage 4 is complete, the wizard is hidden.

The wizard is shown on load until Stage 4 is complete, and it can be dismissed for the current page session by "Not yet" without changing completion state. Clicking Stage 2 OK opens the file chooser, marks the upload as the initial file, and auto-starts list extraction when My Lists opens. After lists and Current Medications are generated, the user is prompted to verify or edit them, and Edit/Verify clears that prompt state. The top wizard message is read from this file and always corresponds to the highest-numbered incomplete stage, which keeps wizard behavior aligned with the Status Tip messages as they evolve.

Stage 3 has additional Saved Files state: when the Stage 3 OK flow uploads a file, the UI marks it as "To be added and indexed" before the user clicks Update and Index KB. That pending state is represented by a per-user localStorage key and a temporary gray chip/checkmark. The Saved Files chips are always derived from actual `inKnowledgeBase` plus this pending flag, and the Update/Index button is shown when `kbIndexingNeeded` is true or when pending files exist. If the user unchecks the pending file before indexing, the pending flag is cleared and the chip reverts to "Add to Knowledge Base."

---

## PRIVATE AI SETUP WIZARD STATE PLACEHOLDERS

This section provides variable names and <placeholders> that a Private AI can use to explain the wizard state to the user. Fill in the placeholders before adding this file to chat context.

Wizard summary template:
User <USER_ID> wizard state:
- showAgentSetupDialog=<SHOW_WIZARD> (true unless Stage 4 complete)
- wizardActiveStage=<WIZARD_ACTIVE_STAGE> (highest incomplete stage)
- wizardTopMessage="<WIZARD_TOP_MESSAGE>"
- wizardAgentReady=<WIZARD_AGENT_READY> (agent endpoint ready)
- wizardCurrentMedications=<WIZARD_CURRENT_MEDS> (Current Medications list exists)
- wizardHasFilesInKB=<WIZARD_HAS_KB_FILES> (KB has indexed files)
- wizardPatientSummary=<WIZARD_PATIENT_SUMMARY> (Patient Summary exists)
- wizardStage3Complete=<WIZARD_STAGE3_COMPLETE> (localStorage wizard-completion-<USER_ID>)
- sessionStorage.autoProcessInitialFile=<AUTO_PROCESS_INITIAL_FILE>
- localStorage.wizardKbPendingFileName-<USER_ID>=<PENDING_KB_FILE_NAME> (Stage 3 pending file)
- kbIndexingNeeded=<KB_INDEXING_NEEDED> (server user-status flag)

Recommended explanation for the user (fill placeholders, then speak it plainly):
"Your Private AI setup is currently on Stage <WIZARD_ACTIVE_STAGE> because:
Agent ready: <WIZARD_AGENT_READY>, Current Medications: <WIZARD_CURRENT_MEDS>,
KB files indexed: <WIZARD_HAS_KB_FILES>, Patient Summary: <WIZARD_PATIENT_SUMMARY>.
The wizard will hide only after Stage 4 is complete (Patient Summary exists).
If you just uploaded an Apple Health PDF, lists extraction may still be running;
once Current Medications is generated and verified, Stage 2 will check off."

---

## Complete Status Tip Messages Reference

All status tip messages displayed in the application (numbered 1-17, corresponding to workflow stages 1-13 plus additional status messages):

**Workflow Stage Messages (1-13):**

1. Ready to chat (workflowStage: null - Initial state when user account is created)
2. Support requested. You will be notified when your private AI agent is ready. (workflowStage: request_sent)
3. Ready to chat (workflowStage: approved - Admin has started provisioning the user)
4. Ready to chat (workflowStage: agent_named - Agent has been successfully created in DigitalOcean)
5. Your agent is ready. Use the paperclip to import files for your knowledge base. (workflowStage: agent_deployed)
6. Update your knowledge base using the [Stored Files] tab. (workflowStage: files_stored - User has uploaded files to their account, no KB yet) / Ready to chat (if KB exists)
7. Ready to chat but your knowledge base is still empty. (workflowStage: unknown - Fallback/default value when workflowStage is not set, shown when KB exists but has no indexed files) / Ready to chat (if KB has indexed files)
8. Update your knowledge base using the [Stored Files] tab. (workflowStage: files_archived)
9. Knowledge base being indexed. This can take up to 60 minutes. (workflowStage: indexing)
10. Your patient summary is available. Ask your agent for it in the chat anytime. (workflowStage: patient_summary)
11. Public AIs see only what you see in the chat, including any paperclip documents. (workflowStage: public_llm)
12. You can save the chat to your computer or save it online. (workflowStage: chat_modified)
13. Open [Saved Chats] to restore one or share a deep link. (workflowStage: link_stored)

**Additional Status Messages (14-17):**

14. Loading... (Initial state when component mounts)
15. User not logged in (When user is not authenticated)
16. Unable to load status / Error loading status (When API call fails or exception occurs)
17. KB Indexing Complete: ${status.filesIndexed} files indexed / KB Indexing Error / KB Setup: ${status.phase} (Dynamic indexing status messages)

---

**Deep Link Format**: `{frontendUrl}/?editMedications={token}&userId={userId}`
**Token Expiration**: 7 days from generation

---

## Welcome Page Video Caption

**Privacy Note:** This demo will not share your health records or chats with anyone unless you choose to share a chat with a public AI like ChatGPT or via a deep link. The demo host (agropper.xyz, me) could access your records and chats but you will be registered under a pseudonym and I have no reason to fish through anybody's records without a written request. For privacy from me as open source code and cloud hosting administrator, you should get your own copy of the open source code and a Digital Ocean account.

**No Password** (Default)  If you are on your own private computer, you can try MAIA without a password or passkey as long as you use the same browser each time. When you "Sign Out" of MAIA, your private records will be backed up locally and removed form the cloud. When you return to MAIA in the same browser, you will be offered the opprtunity to restore your cloud files and any deep links will be accessible again.

**Passkeys** (Optional)  Setting a Passkey when you start or later, when you Sign Out of a No Password account, allows you to access MAIA from any computer, browser, or mobile device. It also keeps your priavte records in the cloud and your deep links active. Passkeys must be used on a public or shared computer. Otherwise, there's no significant difference in privacy as compared to the No Password mode.

**The Wizard** Greets you when you open a new account to guide you through adding your private records and creating and AI-enhanced knowledge base for your Private AI agent. If you have an iPhone or iPad, get as many records as you can using Apple Health and click "Export PDF" to save the file to your MAIA computer. Your records will be collected in minutes instead of days and MAIA will use them to create a detailed index in eight or so different categories and will suggest a Current Medications list for you to edit and verify.

Although it's fast, the Apple Health export will not have the full text notes you get via a pateint portal download. Request the complete records using the patient portal of all of your providers. The Wizard will guide you to add these records and enhance your knowledge base. 

With MAIA, public AIs like ChatGPT will not have access to your records except as part of a chat that you see and control. Doctors and other users you invite by sharing a deep link will have access to your records by asking your Private AI questions in the chat. You can disable this option in your My Agent settings.

**AI IS NOT PERFECT** MAIA gives you the opportunity to edit and verify whatever you or others might see in the chats. The Wizard requires verification for Current Medications and the Patient Summary. It is your responsibility to check the responses from Private AI as well as public AIs you choose. MAIA helps you by offering direct links to information in the PDF files you imported from your health care providers.

---
![CC-BY](by.png)
 MAIA by Adrian Gropper, MD

---

## Random Names

Emily Johnson
Michael Smith
Jessica Brown
Matthew Davis
Ashley Wilson
Christopher Moore
Sarah Taylor
Joshua Anderson
Amanda Martinez
Daniel Thomas
Megan Jackson
Andrew White
Stephanie Harris
Justin Martin
Nicole Thompson
Brandon Garcia
Elizabeth Martinez
Ryan Robinson
Brittany Clark
David Lewis
Samantha Walker
Jonathan Lee
Lauren Hall
James Allen
Melissa Young
Anthony King
Kimberly Wright
Robert Scott
Rebecca Green
Jason Adams
Michelle Baker
Eric Gonzalez
Heather Nelson
Kevin Carter
Angela Perez
Brian Mitchell
Rachel Roberts
Tyler Turner
Amber Phillips
Adam Campbell
Laura Parker
Nicholas Evans
Jennifer Edwards
Zachary Collins
Christina Stewart
Sean Morris
Katie Sanchez
Justin Rogers
Natalie Reed
Aaron Cook
Olivia Richardson
Steven Simmons
Hannah Foster
Benjamin Powell
Lauren Howard
Ethan Ward
Grace Cox
Alexander Flores
Victoria Ramirez
Dylan Rivera
Madison Brooks
Jordan Kelly
Abigail Sanders
Christian Price
Chloe Butler
Tyler Bennett
Sophia Barnes
Jack Russell
Alexis Murphy
Elijah Griffin
Lily Hayes
Gabriel Cooper
Hailey Morgan
Caleb Peterson
Sydney Coleman
Lucas Perry
Kaitlyn Bell
Gavin Long
Danielle Hughes
Mason Foster
Jenna Ward
Aiden Bryant
Kelsey Fisher
Connor Hamilton
Paige Simmons
Logan Webb
Shelby Greene
Owen Fox
Carly Knight
Hunter Stone
Sierra Walters
Isaac Curtis
Mackenzie Bishop
Blake Farmer
Victoria Holland
Grant Chambers
Autumn Franklin
Cole Lawrence
Brooke Matthews
Nathaniel Douglas

---

## More

# NEW AGENT SPECIFICATIONS
# Based on sun6 agent structure and DigitalOcean GenAI API
# Reference: https://docs.digitalocean.com/reference/api/digitalocean/#tag/GradientAI-Platform

## CURRENT SUN6 AGENT DETAILS (Reference)
Agent UUID: 53496a40-b8e7-11f0-b074-4e013e2ddde4
Agent Name: sun6-agent-11032025
Project ID: 90179b7c-8a42-4a71-a036-b4c2bea2fe59
Region: tor1

Model Details:
  UUID: 18bc9b8f-73c5-11f0-b074-4e013e2ddde4
  Name: OpenAI GPT-oss-120b
  Inference Name: openai-gpt-oss-120b
  Version: 1
  Inference Version: 4294967296

Deployment:
  Status: STATUS_RUNNING
  URL: https://sbviwtey3l3setqnghzxj5dj.agents.do-ai.run
  Visibility: VISIBILITY_PLAYGROUND

Configuration:
  max_tokens: 16384
  top_p: 1
  temperature: 0.0
  k: 10
  retrieval_method: RETRIEVAL_METHOD_NONE

---

## CREATE AGENT SPECIFICATION
Endpoint: POST /v2/gen-ai/agents
Reference: https://docs.digitalocean.com/reference/api/digitalocean/#tag/GradientAI-Platform/operation/genai_create_agent

Request Body:
{
  "name": "{userId}-agent-{YYYYMMDD}",
  "instruction": "<MAIA_INSTRUCTION_TEXT>",
  "model": {
    "uuid": "{model_uuid}"
  },
  "project_id": "{project_id}",
  "region": "tor1",
  "max_tokens": 16384,
  "top_p": 1,
  "temperature": 0.1,
  "k": 10,
  "retrieval_method": "RETRIEVAL_METHOD_NONE"
}

Required Fields:
  - name: String (e.g., "sun7-agent-20241103")
  - model.uuid: String (UUID of the model to use)
  - project_id: String (UUID of the project)

Optional Fields:
  - instruction: String (Agent instruction/prompt)
  - region: String (Default: "tor1")
  - max_tokens: Integer (Default: 16384)
  - top_p: Float (Default: 1)
  - temperature: Float (Default: 0)
  - k: Integer (Default: 10, for retrieval if enabled)
  - retrieval_method: String (e.g., "RETRIEVAL_METHOD_NONE")

Response:
{
  "agent": {
    "uuid": "{agent_uuid}",
    "name": "{agent_name}",
    "model": {
      "uuid": "{model_uuid}",
      "name": "{model_name}",
      "inference_name": "{inference_name}"
    },
    "project_id": "{project_id}",
    "deployment": {
      "uuid": "{deployment_uuid}",
      "url": "{deployment_url}",
      "status": "STATUS_PENDING" | "STATUS_RUNNING" | "STATUS_FAILED",
      "visibility": "VISIBILITY_PLAYGROUND"
    },
    "created_at": "ISO8601 timestamp",
    "updated_at": "ISO8601 timestamp"
  }
}

---

## UPDATE AGENT SPECIFICATION
Endpoint: PUT /v2/gen-ai/agents/{agent_uuid}
Reference: https://docs.digitalocean.com/reference/api/digitalocean/#tag/GradientAI-Platform/operation/genai_update_agent

Request Body (all fields optional):
{
  "instruction": "<UPDATED_MAIA_INSTRUCTION_TEXT>",
  "max_tokens": 16384,
  "top_p": 1,
  "temperature": 0,
  "k": 10,
  "retrieval_method": "RETRIEVAL_METHOD_NONE"
}

Updateable Fields:
  - instruction: String (Agent instruction/prompt)
  - max_tokens: Integer
  - top_p: Float
  - temperature: Float (should be 0)
  - k: Integer
  - retrieval_method: String

Note: Cannot update name, model, or project_id after creation.

Response:
{
  "agent": {
    "uuid": "{agent_uuid}",
    "name": "{agent_name}",
    "instruction": "{updated_instruction}",
    "model": {
      "uuid": "{model_uuid}",
      "name": "{model_name}",
      "inference_name": "{inference_name}"
    },
    "project_id": "{project_id}",
    "deployment": {
      "uuid": "{deployment_uuid}",
      "url": "{deployment_url}",
      "status": "STATUS_RUNNING",
      "visibility": "VISIBILITY_PLAYGROUND"
    },
    "max_tokens": 16384,
    "top_p": 1,
    "temperature": 0,
    "k": 10,
    "retrieval_method": "RETRIEVAL_METHOD_NONE",
    "updated_at": "ISO8601 timestamp"
  }
}



## AGENT DEPLOYMENT STATUS
After creation, agent deployment status transitions:
1. STATUS_PENDING - Agent is being created/deployed
2. STATUS_RUNNING - Agent is ready to use
3. STATUS_FAILED - Agent deployment failed

Wait for deployment:
- Poll GET /v2/gen-ai/agents/{agent_uuid} until deployment.status === "STATUS_RUNNING"
- Typical deployment time: 1-3 minutes
- Check deployment.url availability once STATUS_RUNNING

---

## GET AGENT DETAILS (for reference)
Endpoint: GET /v2/gen-ai/agents/{agent_uuid}

Use this to:
- Check deployment status after creation
- Verify agent configuration before update
- Get deployment URL for API endpoint configuration

---

## NOTES FOR IMPLEMENTATION

1. Model UUID Resolution:
   - Try: DO_MODEL_ID environment variable
   - Fallback: Get from existing agents (list agents, get first, extract model.uuid)
   - Fallback: List models, prefer "openai-gpt-oss-120b" (inference_name), else first available
   - Must be valid UUID format

2. Project ID Resolution:
   - Try: DO_PROJECT_ID environment variable
   - Fallback: Get from existing agents (list agents, get first, extract project_id)
   - Must be valid UUID format

3. Agent Name Format:
   - Pattern: "{userId}-agent-{YYYYMMDD}"
   - Example: "sun7-agent-20241103"
   - Must be unique within project

4. Deployment Wait:
   - After create, wait 2-5 seconds before first status check
   - Poll every 5-10 seconds until STATUS_RUNNING
   - Maximum wait: 5 minutes (60 attempts @ 5s interval)
   - Once STATUS_RUNNING, deployment.url is available

5. Update Agent:
   - Only update if instruction or configuration needs changing
   - Cannot change: name, model, project_id after creation
   - Update should be done after deployment is STATUS_RUNNING

6. API Key Creation:
   - After agent creation, create API key: POST /v2/gen-ai/agents/{agent_uuid}/api_keys
   - Key name: "agent-{agent_uuid}-api-key"
   - Store secret_key in user document

GET /v2/gen-ai/knowledge_bases/{knowledge_base_uuid}/indexing_jobs